<div class='col-xs-12 col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2' style='min-height:100vh;padding-bottom:50px;'>
  <wizard on-finish='createOffer()'>
    <wz-step title='Offer Basics' canexit='validateStep1'>
      <div class='well well-lg'>
        <form class='form-horizontal'>
          <fieldset>
            <legend>Offer Basics</legend>
            <div class='form-group' ng-class='{"has-error": formFailure && !offer.offer_type}'>
              <label for='offer_type' class='col-md-2 control-label'>Offer Type <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <select class='form-control' ng-model='offer.offer_type'>
                  <option value='' ng-if='!offer.offer_type'>Choose an offer type</option>
                  <option value='checkin' ng-if='isPaying'>Checkin Offer</option>
                  <option value='offer' ng-if='isPaying'>Promoted Offer</option>
                  <option value='deal'>Deal</option>
                  <option value='bank_deal'>Bank Deal</option>
                </select>
              </div>
            </div>
            <div class='form-group' ng-class='{"has-error": formFailure && offer.user_sourced && !offer.offer_user_source}'>
              <label for='is_user_sourced' class='col-md-2 control-label'>User Sourced?</label>
              <div class='col-md-6'>
                <button type='button' class='btn btn-success' ng-model='offer.user_sourced' btn-checkbox>{{offer.user_sourced?'YES': 'NO'}}</button>
              </div>
            </div>
            <div class='form-group' ng-class='{"has-error": formFailure && offer.user_sourced && !offer.offer_user_source}' ng-if='offer.user_sourced'>
              <label for='user_source' class='col-md-2 control-label'>User ID</label>
              <div class='col-md-6'>
                <input type='text' ng-model='offer.offer_user_source' class='form-control'>
              </div>
            </div>
          </fieldset>
        </form>
      </div>
      <div class='well well-lg' ng-if='offer.offer_type=="checkin"'>
        <form class='form-horizontal'>
          <fieldset>
            <legend>Offer Rules</legend>
            <div class='form-group'>
              <label for='criteria' class='col-md-2 control-label'>Criteria <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6 col-lg-4' ng-class='{"has-error": formFailure && !offer.rule.event_match}'>
                <select class='form-control' ng-model='offer.rule.event_match'>
                  <option value='' ng-if='!offer.rule.event_match'>--- Choose a Criteria ---</option>
                  <option ng-repeat='match in event_matches' value='{{match.value}}'>{{match.name}}</option>
                </select>
              </div>
            </div>
            <div class='form-group' ng-if='offer.rule.event_match'>
              <div class='col-md-10 col-md-offset-2 col-lg-8'>
                <div class='col-md-12'>Reward will be unlocked on</div>
                <div class='row' ng-if='offer.rule.event_match=="on every"'>
                  <div class='col-md-12' ng-class="{'has-error': formFailure && !offer.rule.event_count}">
                    <label class='col-md-3 control-label'>Every <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control text-right' ng-model='offer.rule.event_count' placeholder='Eg. 1, 2, 3...' min='1' steps='1' max='{{(offer.rule.event_end-offer.rule.event_start) || 1}}'>
                        <div class='input-group-addon'>checkin(s)</div>
                      </div>
                    </div>
                  </div>
                  <div class='col-md-12' ng-class="{'has-error': formFailure && !offer.rule.event_start}">
                    <label class='col-md-3 control-label'>Starting from <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control text-right' ng-model='offer.rule.event_start' placeholder='Eg. 1, 2, 3...' min='0' steps='1'>
                        <div class='input-group-addon'>
                          <span ng-if='offer.rule.event_start==1'>st checkin</span>
                          <span ng-if='offer.rule.event_start==2'>nd checkin</span>
                          <span ng-if='offer.rule.event_start==3'>rd checkin</span>
                          <span ng-if='offer.rule.event_start>3 || !offer.rule.event_start'>th checkin</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class='col-md-12' ng-class='{"has-error": formFailure && !offer.rule.event_end}'>
                    <label class='col-md-3 control-label'>Upto <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control text-right' ng-model='offer.rule.event_end' placeholder='Eg. 1, 2, 3...' min='{{(offer.rule.event_start + 1) || 1}}'>
                        <div class='input-group-addon'>
                          <span ng-if='offer.rule.event_end==1'>st checkin</span>
                          <span ng-if='offer.rule.event_end==2'>nd checkin</span>
                          <span ng-if='offer.rule.event_end==3'>rd checkin</span>
                          <span ng-if='offer.rule.event_end>3 || !offer.rule.event_end'>th checkin</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class='row' ng-if='offer.rule.event_match=="after"'>
                  <div class='col-md-12 text-center'>
                    <h4>Every checkin!</h4>
                  </div>
                  <div class='col-md-12' ng-class='{"has-error": formFailure && !offer.rule.event_start}'>
                    <label class='col-md-3 control-label'>Starting from <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control' ng-model='offer.rule.event_start' placeholder='Eg. 1, 2, 3...' min='0' steps='1'>
                        <div class='input-group-addon'>
                          <span ng-if='offer.rule.event_start==1'>st checkin</span>
                          <span ng-if='offer.rule.event_start==2'>nd checkin</span>
                          <span ng-if='offer.rule.event_start==3'>rd checkin</span>
                          <span ng-if='offer.rule.event_start>3 || !offer.rule.event_start'>th checkin</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class='col-md-12' ng-class='{"has-error": formFailure && !offer.rule.event_end}'>
                    <label class='col-md-3 control-label'>Upto <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control' ng-model='offer.rule.event_end' placeholder='Eg. 1, 2, 3...' min='{{offer.rule.event_start + 1}}'>
                        <div class='input-group-addon'>
                          <span ng-if='offer.rule.event_end==1'>st checkin</span>
                          <span ng-if='offer.rule.event_end==2'>nd checkin</span>
                          <span ng-if='offer.rule.event_end==3'>rd checkin</span>
                          <span ng-if='offer.rule.event_end>3 || !offer.rule.event_end'>th checkin</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class='row' ng-if='offer.rule.event_match=="on only"'>
                  <div class='col-md-12' ng-class='{"has-error": formFailure && !offer.rule.event_count}'>
                    <label class='col-md-3 control-label'>On the <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <div class='input-group'>
                        <input type='number' class='form-control' ng-model='offer.rule.event_count' placeholder='Eg. 1, 2, 3...' min='1'>
                        <div class='input-group-addon'>
                          <span ng-if='offer.rule.event_count==1'>st checkin</span>
                          <span ng-if='offer.rule.event_count==2'>nd checkin</span>
                          <span ng-if='offer.rule.event_count==3'>rd checkin</span>
                          <span ng-if='offer.rule.event_count>3 || !offer.rule.event_count'>th checkin</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
        </form>
      </div>
      <div class='well well-lg'>
        <form class='form-horizontal'>
          <fieldset>
            <legend>Reward Details</legend>
            <div class='form-group'>
              <label class='col-md-2 control-label'>Reward Type <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.reward_type}'>
                <select class='form-control' ng-model='offer.actions.reward.reward_meta.reward_type'>
                  <option value='' ng-if='!offer.actions.reward.reward_meta.reward_type'>Choose a Reward Type</option>
                  <option value='buyxgety'>Buy X Get Y</option>
                  <option value='free'>Free</option>
                  <option value='flatoff'>Flat Off</option>
                  <option value='discount'>Discount</option>
                </select>
              </div>
            </div>
            <div class='form-group' ng-if='offer.actions.reward.reward_meta.reward_type'>
              <label class='col-md-2 control-label'>Reward Specifics </label>
              <div class='col-md-10' ng-if='offer.actions.reward.reward_meta.reward_type=="buyxgety"'>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.item_x}'>
                  <label class='col-md-3 control-label'>Free Item <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <button type='button' class='btn btn-block btn-primary' ng-click='chooseItem("buyxgety_1", true)' ng-if='!offer.actions.reward.reward_meta.item_x'>Choose Item</button>
                    <button type='button' class='btn btn-block btn-success' ng-click='chooseItem("buyxgety_1", true)' ng-if='offer.actions.reward.reward_meta.item_x'>Update Item</button>
                  </div>
                </div>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.item_y}'>
                  <label class='col-md-3 control-label'>Paid Item <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <button type='button' class='btn btn-block btn-primary' ng-click='chooseItem("buyxgety_2", true)' ng-if='!offer.actions.reward.reward_meta.item_y'>Choose Item</button>
                    <button type="button" class='btn btn-block btn-success' ng-click='chooseItem("buyxgety_2", true)' ng-if='offer.actions.reward.reward_meta.item_y'>Update Item</button>
                  </div>
                </div>
              </div>
              <div class='col-md-10' ng-if='offer.actions.reward.reward_meta.reward_type=="buyonegetone"'>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.bogo}'>
                  <label class='col-md-3 control-label'>BOGO Item <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <input type='text' ng-model='offer.actions.reward.reward_meta.bogo' class='form-control' placeholder='provide item name here'>
                  </div>
                </div>
              </div>
              <div class='col-md-10' ng-if='offer.actions.reward.reward_meta.reward_type=="discount"'>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.percent}'>
                  <label class='col-md-3 control-label'>Percent Discount <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <input type='number' min='1' steps='1' class='form-control' ng-model='offer.actions.reward.reward_meta.percent'>
                  </div>
                </div>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.max}'>
                  <label class='col-md-3 control-label'>Max Discount <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <div class='input-group'>
                      <div class='input-group-addon'>Rs.</div>
                      <input type='number' ng-model='offer.actions.reward.reward_meta.max' class='form-control' placeholder='maximum discount amount'>
                    </div>
                  </div> 
                </div>
              </div>
              <div class='col-md-10' ng-if='offer.actions.reward.reward_meta.reward_type=="flatoff"'>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.off}'>
                  <label class='col-md-3 control-label'>Amount Off <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <div class='input-group'>
                      <div class='input-group-addon'>Rs.</div>
                      <input type='number' ng-model='offer.actions.reward.reward_meta.off' class='form-control'>
                    </div>
                  </div>
                </div>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.spend}'>
                  <label class='col-md-3 control-label'>Minimum Spend <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <div class='input-group'>
                      <div class='input-group-addon'>Rs.</div>
                      <input type='number' ng-model='offer.actions.reward.reward_meta.spend' class='form-control'>
                    </div>
                  </div>
                </div>
              </div>
              <div class='col-md-10' ng-if='offer.actions.reward.reward_meta.reward_type=="free"'>
                <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.reward_meta.title}'>
                  <label class='col-md-3 control-label'>Free Item <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                  <div class='col-md-6'>
                    <button type='button' class='btn btn-block btn-primary' ng-click='chooseItem("free", true)' ng-if='!offer.actions.reward.reward_meta.item_free'>Choose Item</button>
                    <button type='button' class='btn btn-block btn-success' ng-click='chooseItem("free", true)' ng-if='offer.actions.reward.reward_meta.item_free'>Update Item</button>
                  </div>
                </div>
              </div>
            </div>
            <div class='form-group' ng-if='offer.actions.reward.reward_meta.reward_type==="flatoff" || offer.actions.reward.reward_meta.reward_type==="discount"'>
              <label class='col-md-2 control-label'>Apply to all Items</label>
              <div class='col-md-6'>
                <input bs-switch ng-model='offer.offer_items.all' type='checkbox' switch-off-text='NO' switch-on-text='YES'>
              </div>
            </div>
            <div class='form-group' ng-if='(offer.actions.reward.reward_meta.reward_type==="flatoff" || offer.actions.reward.reward_meta.reward_type==="discount") && !offer.offer_items.all'>
              <label class='col-md-2 control-label'>Reward Items</label>
              <div class='col-md-6'>
                <button class='btn btn-block btn-primary' ng-if='(offer.actions.reward.reward_meta.reward_type=="flatoff" || offer.actions.reward.reward_meta.reward_type=="discount") && !offer.offer_items.menu_id' ng-click='chooseItem("", false)'>Choose Items</button>
                <button class='btn btn-block btn-success' ng-if='(offer.actions.reward.reward_meta.reward_type=="flatoff" || offer.actions.reward.reward_meta.reward_type=="discount") && offer.offer_items.menu_id' ng-click='chooseItem("", false)'>Update Items</button>
                {{offer.offer_items}}
              </div>
            </div>
            <div class='form-group' style='padding-top:30px'>
              <label class='col-md-2 control-label'>Reward Info</label>
              <div class='col-md-10'>
                <div class='alert alert-warning' ng-if='!offer.actions.reward.reward_meta.reward_type'>Choose a valid reward type first</div>
                <div class='alert alert-warning' ng-if='(offer.actions.reward.reward_meta.reward_type=="buyxgety" && !(offer.actions.reward.reward_meta.item_x && offer.actions.reward.reward_meta.item_y)) || (offer.actions.reward.reward_meta.reward_type=="discount" && !(offer.actions.reward.reward_meta.percent && offer.actions.reward.reward_meta.max)) || (offer.actions.reward.reward_meta.reward_type=="flatoff" && !(offer.actions.reward.reward_meta.off && offer.actions.reward.reward_meta.spend)) || (offer.actions.reward.reward_meta.reward_type=="free" && !offer.actions.reward.reward_meta.item_free)'>Input reward specifics to edit details</div>
                <div class='form-group' ng-if='(offer.actions.reward.reward_meta.reward_type=="buyxgety" && offer.actions.reward.reward_meta.item_x && offer.actions.reward.reward_meta.item_y) || (offer.actions.reward.reward_meta.reward_type=="discount" && (offer.actions.reward.reward_meta.percent && offer.actions.reward.reward_meta.max)) || (offer.actions.reward.reward_meta.reward_type=="flatoff" && (offer.actions.reward.reward_meta.off && offer.actions.reward.reward_meta.spend)) || (offer.actions.reward.reward_meta.reward_type=="free" && offer.actions.reward.reward_meta.item_free)'>
                  <div class='form-group' ng-class="{'has-error': formFailure && !offer.actions.reward.header}">
                    <label class='col-md-3 control-label'>Header <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <input type='text' ng-model='offer.actions.reward.header' class='form-control'>
                    </div>
                  </div>
                  <div class='form-group' ng-class="{'has-error': formFailure && !offer.actions.reward.line1}">
                    <label class='col-md-3 control-label'>Line 1 <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
                    <div class='col-md-6'>
                      <input type='text' ng-model='offer.actions.reward.line1' class='form-control'>
                    </div>
                  </div>
                  <div class='form-group'>
                    <label class='col-md-3 control-label'>Line 2</label>
                    <div class='col-md-6'>
                      <input type='text' ng-model='offer.actions.reward.line2' class='form-control'>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class='form-group'>
              <label class='col-md-2 control-label'>Offer Description</label>
              <div class='col-md-6'>
                <textarea class='form-control' ng-model='offer.actions.reward.description' rows='3' style='resize:none;overflow:auto;'></textarea>
                <div class='help-block'>Add detailed offer description here if header, line 1 and line 2 do not capture all offer details.</div>
              </div>
            </div>
          </fieldset>
        </form>
      </div>
      <div class='clearfix'></div>
      <button class='btn btn-primary' wz-next>Continue</button>
    </wz-step>
    <wz-step title='T&C' canexit='validateStep2'>
      <div class='well well-lg'>
        <form class='form-horizontal'>
          <fieldset>
            <legend>Terms & Conditions</legend>
            <div class='form-group' ng-if='offer.offer_type=="checkin" || offer.offer_type=="offer"' ng-class='{"has-error": formFailure && !offer.minimum_bill_value}'>
              <label class='col-md-2 control-label'>Minimum Bill <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <div class='input-group'>
                  <div class='input-group-addon'>Rs.</div>
                  <input type='number' class='form-control' ng-model='offer.minimum_bill_value'>
                </div>
              </div>
            </div>
            <div class='form-group' ng-class='{"has-error": formFailure && !offer.actions.reward.applicability.dine_in && offer.actions.reward.applicability.delivery}'>
              <label class='col-md-2 control-label'>Applicable For <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <div class='btn-group'>
                  <label class='btn' ng-class='{"btn-primary": offer.actions.reward.applicability.dine_in, "btn-default": !offer.actions.reward.applicability.dine_in}'>
                    <input type='checkbox' autocomplete='off' ng-model='offer.actions.reward.applicability.dine_in'> Dine-In
                  </label>
                  <label class='btn' ng-class='{"btn-primary": offer.actions.reward.applicability.delivery, "btn-default": !offer.actions.reward.applicability.delivery}'>
                    <input type='checkbox' autocomplete='off' ng-model='offer.actions.reward.applicability.delivery'> Delivery
                  </label>
                </div>
              </div>
            </div>
            <div class='form-group' ng-if='offer.offer_type=="checkin"'>
              <label class='col-md-2 control-label'>Lapses in <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <div class='input-group'>
                  <input type='number' class='form-control' ng-model='offer.offer_lapse_days' min='1' steps='1' placeholder='Duration for exclusive availability'>
                  <div class='input-group-addon'> days.</div>
                </div>
              </div>
            </div>
            <div class='form-group' ng-if='offer.offer_type=="checkin"'>
              <label class='col-md-2 control-label'>Expires in <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <div class='input-group'>
                  <input type='number' class='form-control' min='{{offer.offer_lapse_days + 14}}' ng-model='offer.offer_valid_days' placehulder='Actual offer validity duration.'>
                  <div class='input-group-addon'> days.</div>
                </div>
                <div class='help-block'>Expiration duration must be atleast 14 days more than lapse duration</div>
              </div>
            </div>
            <div class='form-group' ng-if='offer.offer_type=="offer"'>
              <label class='col-md-2 control-label'>Offer Cost <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <select class='form-control' ng-model='offer.offer_cost'>
                  <option ng-repeat='i in getRange(18) track by $index' value='{{100 + (25*$index)}}'>{{100 + (25*$index)}}</option>
                </select>
                <span class='help-block'>Cost above is defined in Twyst Bucks</span>
              </div>
            </div>
            <div class='form-group' ng-if='offer.offer_type=="bank_deal"'>
              <label class='col-md-2 control-label'>Deal Source <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <select ng-model='offer.offer_source' class='form-control'>
                  <option value='{{key}}' ng-repeat='(key, val) in offer_sources'>{{val}}</option>
                </select>
              </div>
            </div>
            <div class='form-group'>
              <label class='col-md-2 control-label'>Offer Terms</label>
              <div class='col-md-6'>
                <textarea class='form-control' rows='6' style='resize:none;overflow:auto;' ng-model='offer.actions.reward.terms' placeholder='any terms not covered in the common terms below.'></textarea>
                <div class='help-block'>
                  <p><b>Common terms for all offers</b></p>
                  <ul>
                    <li>Offers (2 or more) cannot be clubbed</li>
                    <li>Offers are not valid on specially priced combinations e.g. any other buffet/brunch deal/corporate dining rate/happy hours etc.</li>
                    <li>Only 1 voucher / offer can be used per bill generated</li>
                    <li>In certain cases, specific items may be part of the offer. The avialability of the specific items is not guaranteed and must be checked with the outlet before using the offer.</li>
                    <li>The offer are provided at the sole discretion of the merchant, and the merchant reserves the right to alter ot withdraw the offer at any time.</li>
                    <li>Offers/vouchers consisting of alcohol/alcohol-based products will be available only to individuals above legal drinking age. The establishment reserves the right to verify the customer's age before providing such reward.</li>
                  </ul>
                </div>
              </div>
            </div>
          </fieldset>
        </form>
      </div>
      <div class='well well-lg'>
        <form class='form-horizontal'>
          <fieldset>
            <legend>Applicability</legend>
            <div class='form-group'>
              <label for='offer_outlets' class='col-md-2 control-label'>Outlets <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-9'>
                <ul class='list-group' ng-if='offer.offer_outlets.length'>
                  <li class='list-group-item' ng-repeat='outlet in offer.offer_outlets track by $index'>{{outlets[outlet].basics.name}}, {{outlets[outlet].contact.location.locality_1[0]}}, {{outlets[outlet].contact.location.locality_2[0]}}
                    <button class='btn btn-sm btn-danger pull-right' ng-click='removeOutlet($index)'><span class='glyphicon glyphicon-trash'></span></button>
                  </li>
                </ul>
                <div class='alert' ng-if='!offer.offer_outlets.length' ng-class='{"alert-warning": !formFailure, "alert-danger": formFailure && !(offer.offer_outlets && offer.offer_outlets.length)}'>
                  <span ng-if='!formFailure'>Start adding outlets below.</span>
                  <span ng-if='formFailure'>Choose atleast one outlet</span>
                </div>
              </div>
            </div>
            <div class='form-group'>
              <label for='add_outlet' class='col-md-2 control-label'>
                <span ng-if='!offer.offer_outlets.length'>Pick the first Outlet</span>
                <span ng-if='offer.offer_outlets.length'>Pick another Outlet</span>
              </label>
              <div class='col-md-6 table-responsive'>
                <table class='table table-bordered table-condensed'>
                  <tbody>
                    <tr ng-repeat='outlet in outlets track by $index' ng-show='!offer.offer_outlets || offer.offer_outlets.indexOf(outlet._id)==-1'>
                      <td><button class='badge pull-left' ng-click='addOutlet(outlet._id)'><span class='glyphicon glyphicon-ok'> Add</span></button></td>
                      <td>{{outlet.basics.name}}, {{outlet.contact.location.locality_1[0]}}, {{outlet.contact.location.locality_2[0]}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class='form-group'>
              <label class='col-md-2 control-label'>Applicability <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-10'>
                <div class='form-group' ng-if='offer.offer_outlets.length'>
                  <label class='col-md-3 control-label'>Clone Outlet Timings</label>
                  <div class='col-md-9'>
                    <select ng-model='tempOutlet._id' class='form-control' ng-change='cloneTimings(tempOutlet)'>
                      <option value=''>Choose an Outlet To Clone From</option>
                      <option ng-repeat='outletId in offer.offer_outlets' value='{{outletId}}'>{{outlets[outletId].basics.name}}, {{outlets[outletId].contact.location.locality_1[0]}}, {{outlets[outletId].contact.location.locality_2[0]}}</option>
                    </select>
                  </div>
                </div>
                <div class='alert alert-warning' ng-if='!offer.offer_outlets.length'>
                  <strong>Select atleast one outlet above to set offer timings</strong>
                </div>
                <div class='form-group table-responsive' ng-if='offer.offer_outlets.length'>
                  <table class='table table-bordered table-condensed'>
                    <thead>
                      <th>Day</th>
                      <th>Is Closed?</th>
                      <th ng-repeat='i in getMaxRange() track by $index'>Timing {{$index+1}}</th>
                      <th>Add Timing</th>
                      <th>Apply to all days</th>
                    </thead>
                    <tbody>
                      <tr ng-repeat='day in days'>
                        <th>{{day | uppercase}}</th>
                        <td><input type='checkbox' ng-model='offer.actions.reward.reward_hours[day].closed' ng-change='updateTiming(day, offer.actions.reward.reward_hours)'></td>
                        <td ng-repeat='i in getMaxRange() track by $index'>
                          <div class='col-md-12' ng-if='offer.actions.reward.reward_hours[day].timings.length && offer.actions.reward.reward_hours[day].timings[$index]' ng-click='removeTiming(day, $index, offer.actions.reward.reward_hours)' ng-show='offer.actions.reward.reward_hours[day].timings.length>1' ng-init='initalizeTiming(day, $index, offer.actions.reward.reward_hours)'>
                            <button class='btn btn-sm btn-danger pull-right' ><span class='glyphicon glyphicon-trash'></span></button>
                          </div>
                          <div class='col-md-12' ng-if='offer.actions.reward.reward_hours[day].timings[$index]'>
                            <input type='time' ng-model='offer.actions.reward.reward_hours[day].timings[$index].open.time' placeholder="HH:MM A/P" class='form-control' ng-change='updateTime(day, $index, offer.actions.reward.reward_hours)'>
                          </div>
                          <div class='col-md-12 text-center' ng-if='offer.actions.reward.reward_hours[day].timings[$index]'> to </div>
                          <div class='col-md-12' ng-if='offer.actions.reward.reward_hours[day].timings[$index]'>
                            <input type='time' ng-model='offer.actions.reward.reward_hours[day].timings[$index].close.time' placeholder="HH:MM A/P" class='form-control' ng-change='updateTime(day, $index, offer.actions.reward.reward_hours)'>
                          </div>
                        </td>
                        <td><button class='btn btn-sm btn-default' ng-click='addNewTiming(day, offer.actions.reward.reward_hours)' ng-show='!offer.actions.reward.reward_hours[day].closed'>Add Timing</button></td>
                        <td><button class='btn btn-sm btn-default' ng-click='cloneToAllDays(day, offer.actions.reward.reward_hours)'>Apply to all days</button></td>
                      </tr>
                      <td>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class='form-group'>
              <label class='col-md-2 control-label'>Start Date <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <datepicker ng-model="offer.offer_start_date" show-weeks="true" class="well well-sm"></datepicker>
              </div>
            </div>
            <div class='form-group'>
              <label class='col-md-2 control-label'>End Date <span class='glyphicon glyphicon-asterisk glyphicon-sm'></span></label>
              <div class='col-md-6'>
                <datepicker ng-model="offer.offer_end_date" min-date="offer.offer_start_date" show-weeks="true" class="well well-sm"></datepicker>
              </div>
            </div>
            <div class='clearfix'></div>
            <button class='btn btn-default' wz-previous>Go Back</button>
            <button class='btn btn-primary' wz-next>Review</button>
          </fieldset>
        </form>
      </div>
    </wz-step>
    <wz-step title='Review'>
      <div class='panel panel-default'>
        <div class='panel-heading'>Offer Basics</div>
        <div class='panel-body'>
          <div class='col-md-6'>
            <h1>{{offer.actions.reward.header}}</h1>
            <h3>{{offer.actions.reward.line1}}</h3>
            <h3>{{offer.actions.reward.line2}}</h3>
            <textarea class='form-control' ng-model='offer.actions.reward.description' disabled style='resize:none;overflow:auto;'></textarea>
            <br />
            <textarea class='form-control' rows='6' style='resize:none;overflow:auto;' disabled ng-model='offer.actions.reward.terms'></textarea>
            <div class='pull-left'><div>Lapse Duration</div><span class='label label-success'>{{offer.offer_lapse_days}} days</span></div>
            <div class='pull-right'><div>Expiration Duration</div><span class='label label-success'>{{offer.offer_valid_days}} days</span></div>
          </div>
          <div class='col-md-6'>
            <h4>Offer Type: <span class='label label-primary'>{{offer_types[offer.offer_type]}}</span></h4>
            <div>
              <h4>Validity</h4>
              <span class='label label-info'>{{offer.offer_start_date | date: longDate}}</span> to <span class='label label-info'>{{offer.offer_end_date | date: longDate}}</span>
            </div>
            <div>
              <h4>Reward Type</h4>
              <span class='label label-default'>{{reward_types[offer.actions.reward.reward_meta.reward_type]}}</div>
            <div>
              <h4>Reward Info</h4>
              <div ng-if='offer.actions.reward.reward_meta.reward_type=="discount"'>Get <span class='label label-success'>{{offer.actions.reward.reward_meta.percent + '%'}}</span> for a max discount of upto <span class='label label-success'>{{'Rs.' + offer.actions.reward.reward_meta.max}}</span></div>
              <div ng-if='offer.actions.reward.reward_meta.reward_type=="flatoff"'>Get <span class='label label-success'>{{'Rs.' + offer.actions.reward.reward_meta.off}}</span> on a minimum spend of <span class='label label-success'>{{'Rs.' + offer.actions.reward.reward_meta.spend}}</span></div>
              <div ng-if='offer.actions.reward.reward_meta.reward_type=="free"'>Get <span class='label label-success'>{{offer.actions.reward.reward_meta.free_item_name}}</span> free! </div>
            </div>
            <div ng-if='offer.offer_type=="checkin"'>
              <h4>Offer Rules</h4>
              <div ng-if='offer.rule.event_match=="on every"'>Application on every <span class='label label-success'>{{offer.rule.event_count + ((offer.rule.event_count==1)? 'st': (offer.rule.event_count==2)? 'nd': (offer.rule.event_count==3)? 'rd': 'th')}}</span> checkin from <span class='label label-success'>{{offer.rule.event_start + ((offer.rule.event_start==1)? 'st': (offer.rule.event_start==2)? 'nd': (offer.rule.event_start==3)? 'rd': 'th')}}</span> to <span class='label label-success'>{{offer.rule.event_end + ((offer.rule.event_end==1)? 'st': (offer.rule.event_end==2)? 'nd': (offer.rule.event_end==3)? 'rd': 'th')}}</span> checkin</div>
              <div ng-if='offer.rule.event_match=="after"'>Application on every checkin starts from <span class='label label-success'>{{offer.rule.event_start + ((offer.rule.event_start==1)? 'st': (offer.rule.event_start==2)? 'nd': (offer.rule.event_start==3)? 'rd': 'th')}}</span> to <span class='label label-success'>{{offer.rule.event_end + ((offer.rule.event_end==1)? 'st': (offer.rule.event_end==2)? 'nd': (offer.rule.event_end==3)? 'rd': 'th')}}</span> checkin.</div>
              <div ng-if='offer.rule.event_match=="on only"'>Application on the <span class='label label-success'>{{offer.rule.event_count + ((offer.rule.event_count==1)? 'st': (offer.rule.event_count==2)? 'nd': (offer.rule.event_count==3)? 'rd': 'th')}}</span> checkin.</div>
            </div>
            <div>
              <h4>Applicable on: </h4>
              <span ng-if='offer.actions.reward.applicability.dine_in' class='label label-success'>Dine in</span>
              <span ng-if='offer.actions.reward.applicability.delivery' class='label label-success'>Delivery</span>
            </div>
            <div ng-if='offer.offer_type=="checkin" || offer.offer_type=="offer"'>
              <h4>Minimum Bill <span class='label label-success'>Rs.{{offer.minimum_bill_value}}</span></h4>
            </div>
            <div ng-if='offer.offer_type=="offer"'>
              <h4>Offer Cost <span class='label label-success'>{{offer.offer_cost}}</span> Twyst Bucks</h4>
            </div>
            <div ng-if='offer.offer_type=="bank_deal"'>
              <h4>Deal Source <span class='label label-info'>{{offer_sources[offer.offer_source]}}</span></h4>
            </div>
          </div>
        </div>
      </div>
      <br />
      <div class='panel panel-default'>
        <div class='panel-heading'>Timings & Availability</div>
        <div class='panel-body'>
          <div class='col-md-6'>
            <h3>Timings</h3>
            <div class='row' ng-repeat='day in days'>
              <h4>{{day | uppercase}}</h4>
              <span class='label label-warning' ng-if='offer.actions.reward.reward_hours[day].closed'>Closed</span>
              <span class='label label-success' ng-if='!offer.actions.reward.reward_hours[day].closed'>Open</span>
              <span ng-repeat='timing in offer.actions.reward.reward_hours[day].timings' style='margin-left:10px;margin-right:10px;'><span class='label label-primary'>{{timing.open.time | date: 'hh:mm a'}}</span> to <span class='label label-primary'>{{timing.close.time | date: 'hh:mm a'}}</span></span>
            </div>
          </div>
          <div class='col-md-6'>
            <h4>Outlets Where Available</h4>
            <ul class='list-group' ng-if='offer.offer_outlets.length'>
              <li class='list-group-item' ng-repeat='outlet in offer.offer_outlets track by $index'>{{outlets[outlet].basics.name}}, {{outlets[outlet].contact.location.locality_1[0]}}, {{outlets[outlet].contact.location.locality_2[0]}}</li>
            </ul>
          </div>
        </div>
      </div>
      <button class='btn btn-default' ng-click='backToStart()'>Back to First Step</button>
      <button class='btn btn-primary' wz-next>Create Offer</button>
    </wz-step>
  </wizard>
  <script type='text/ng-template' id='chooseItemTemplate.html'>
    <div class='modal-header'>
      <legend>Select Item</legend>
    </div>
    <div class='modal-body'>
      <div class='form-group'>
        <label class='col-xs-3 control-label'>Choose Menu</label>
        <div class='col-xs-6'>
          <select ng-model='choice.menu_id' class='form-control' ng-change='menuSelected()'>
            <option value='' ng-if='!choice.menu_id'>Choose a menu</option>
            <option ng-repeat='menu in menus' value='{{menu._id}}'>{{menu.menu_type}}</option>
          </select>
        </div>
        <div class='col-xs-2'>
          <button type='button' class='btn btn-block btn-primary' ng-disabled='!choice.menu_id || item_only' ng-click='pickMenu()'><i class='fa fa-check'></i> Pick</button>
        </div>
      </div>
      <div class='clearfix'></div>
      <div class='form-group'>
        <label class='col-xs-3 control-label'>Choose Category</label>
        <div class='col-xs-6'>
          <select ng-model='choice.category_id' class='form-control' ng-change='categorySelected()'>
            <option value='' ng-if='!choice.category_id'>Choose a category</option>
            <option ng-repeat='category in categories' value='{{category._id}}'>{{category.category_name}}</option>
          </select>
        </div>
        <div class='col-xs-2'>
          <button type='button' class='btn btn-block btn-primary' ng-disabled='!choice.category_id || item_only' ng-click='pickCategory()'><i class='fa fa-check'></i> Pick</button>
        </div>
      </div>
      <div class='form-group'>
        <label class='col-xs-3 control-label'>Choose Sub Category</label>
        <div class='col-xs-6'>
          <select ng-model='choice.sub_category_id' class='form-control' ng-change='subCategorySelected()'>
            <option value='' ng-if='!choice.sub_category_id'>Choose a sub Category</option>
            <option ng-repeat='sub_cat in sub_categories' value='{{sub_cat._id}}'>{{sub_cat.sub_category_name}}</option>
          </select>
        </div>
        <div class='col-xs-2'>
          <button type='button' class='btn btn-block btn-primary' ng-disabled='!choice.sub_category_id || item_only' ng-click='pickSubCategory()'><i class='fa fa-check'></i> Pick</button>
        </div>
      </div>
      <div class='form-group'>
        <label class='col-xs-3 control-label'>Choose Item</label>
        <div class='col-xs-6'>
          <select ng-model='choice.item_id' class='form-control' ng-change='itemSelected()'>
            <option value='' ng-if='!choice.item_id'>Choose an item</option>
            <option ng-repeat='item in items' value='{{item._id}}'>{{item.item_name}}</option>
          </select>
        </div>
        <div class='col-xs-2'>
          <button type='button' class='btn btn-block btn-primary' ng-disabled='!choice.item_id' ng-click='pickItem()'><i class='fa fa-check'></i> Pick</button>
        </div>
      </div>
      <div class='form-group' ng-if='item_only'>
        <label class='col-xs-3 control-label'>Choose Option</label>
        <div class='col-xs-12'>
          <div class='col-xs-4' ng-repeat='option in options'>
            <div class='panel panel-primary'>
              <div class='panel-heading'>
                {{option_title}}:{{option.option_set_value}} Rs.{{option.option_set_cost}}
                <button type='button' class='btn btn-sm btn-success' ng-click='pickOptionSet($index)' style='color:white;'><i class='fa fa-lg fa-check'></i> </button>
              </div>
              <div class='panel-body'>
                <label class='control-label'>Options</label>
                <div class='col-xs-12'>
                    <div ng-repeat='sub_option in option.sub_options'>Sub Variance Group: {{sub_option.sub_option_title}}
                      <button type='button' class='btn btn-sm btn-success' ng-click='pickSubOption(option._id, sub_option._id)'><i class='fa fa-check'></i> </button>
                        <div ng-repeat='sub_option_obj in sub_option.sub_option_set'>
                            <p>{{sub_option_obj.sub_option_value}} <i class='fa fa-inr'></i>{{sub_option_obj.sub_option_cost}}
                              <button type='button' class='btn btn-xs btn-success' ng-click='pickSubOptionObj(option._id, sub_option._id, sub_option_obj._id)'><i class='fa fa-check'></i> </button>
                            </p>
                        </div>
                    </div>
                </div>
                <div class='clearfix'></div>
                <label class='control-label'>Addons</label>
                <div class='col-xs-12'>
                    <div ng-repeat='addon in option.addons'>Addon Group: {{addon.addon_title}}
                      <button type='button' class='btn btn-xs btn-success' ng-click='pickAddon(option._id, addon._id)'><i class='fa fa-check'></i> </button>
                        <div ng-repeat='addon_obj in addon.addon_set'>
                            <p>{{addon_obj.addon_value}} <i class='fa fa-inr'></i>{{addon_obj.addon_cost}}
                              <button type='button' class='btn btn-xs btn-success' ng-click='pickAddonObj(option._id, addon._id, addon_obj._id)'><i class='fa fa-check'></i> </button>
                            </p>
                        </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='modal-footer'>
    </div>
  </script>
</div>